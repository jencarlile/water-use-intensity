<link rel="import" href="../polymer/polymer.html">

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.8.0/lodash.js" type="text/javascript"></script>

<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="../iron-input/iron-input.html">


<link rel="import" href="wui-records.html">
<link rel="import" href="wui-result.html">



<dom-module id="wui-info">
  <link rel="import" type="css" href="wui-style.css">
  
<style>
    :host {
        --paper-input-container-color: whitesmoke;
        --paper-input-container-focus-color: #4FAEFF;
        --paper-input-container-input-color: whitesmoke;
    }

    paper-input, paper-input-container {
        width: 220px;
        color: whitesmoke;
    }
    paper-button {
        color: #28577F;
        background: whitesmoke;
    }

    select {
        font-size: 20px;
        width: 220px;
        margin-bottom: 20px;
    }

    #bldTypeLabel {
        color: whitesmoke;
        font-size: 12px;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        display: block;
        margin-top: 16px;
        margin-bottom: 10px;
    }

    #submit {
        margin-top: 40px;
    }

    #leftSide, #resultSection {
        width: 45%;
        display: inline-block;
        vertical-align: top;
    }

</style>

<template>
    <wui-records id="recQuery" buildingRecord="{{record}}"></wui-records>

    <div id="leftSide">
        <form>
            <paper-input-container always-float-label>
                <label>Street Address</label>
                <input is="iron-input" bind-value="{{_streetAddress}}">
            </paper-input-container>
            <paper-input-container always-float-label>
                <label>City</label>
                <input is="iron-input" bind-value="{{_city}}">
            </paper-input-container>
            <paper-input-container always-float-label>
                <label>State</label>
                <input is="iron-input" bind-value="{{_state}}">
            </paper-input-container>

            <label id="bldTypeLabel">Building Type</label>
            <select id="bldTypeSelect">
                <template is="dom-repeat" items="{{buildingTypes}}">
                    <option value="{{item}}">{{item}}</option>
                </template>
            </select>

            <paper-input-container always-float-label>
                <label>Gross Square Feet</label>
                <input type="number" is="iron-input" bind-value="{{_sqft}}">
            </paper-input-container>
            <paper-input-container always-float-label>
                <label>Total Yearly Water Use</label>
                <input type="number" is="iron-input" bind-value="{{_totalWaterUsage}}">
            </paper-input-container>
            <paper-input-container always-float-label>
                <label>Consumption Year</label>
                <input type="number" is="iron-input" bind-value="{{_consumptionYear}}">
            </paper-input-container>
            <paper-input-container always-float-label="true">
                <label>Building Description (optional)</label>
                <input is="iron-input" bind-value="{{_bldDescription}}">
            </paper-input-container>

            <paper-button raised id="submit">What's my WUI?</paper-button>
        </form>
    </div>

    <wui-result id="resultSection" record="[[record]]"></wui-result>
</template>

<script>
(function() {
    Polymer({
    is: "wui-info",

    properties: {
        buildingTypes: {
            type: Array,
            value: function() {
                return _.values(this.$.recQuery.buildingCategories)
            }
        },
        record: {
            // type: Object,
            notify: true,
            observer: 'recordChanged'
        },

        _bldType: { type: String },
        _totalWaterUsage: { type: Number },
        _sqft: { type: Number },
        _streetAddress: { type: String },
        _city: { type: String },
        _state: { type: String },
        _consumptionYear: { type: Number },
        _bldDescription: { type: String }
    },


    listeners: {
        'submit.tap': 'submit'
    },

    ready: function(){ },

    submit: function() {
        this._sqft = parseInt(this._sqft);
        this._totalWaterUsage = parseInt(this._totalWaterUsage);
        this._consumptionYear = parseInt(this._consumptionYear);

        var wui = this._totalWaterUsage / this._sqft;

        // Note, not setting zip code, year build, or report type
        var params = {
            streetAddress: this._streetAddress,
            city: this._city,
            state: this._state,
            description: this._bldDescription,
            reportYear: this._consumptionYear,
            waterUsageIntensity: wui,
            sqFt: this._sqft,
            totalWaterUsage: this._totalWaterUsage
        };

        var res = this.$.recQuery.addBuildingRecord(params);
        res.then(function(data, status, headers, config){
            this.record = params;
            console.log("SUCCESS INFO" );
        }.bind(this)).fail(function(data, status, headers, config){
            console.log("ERROR!!");
        });
    },
    recordChanged: function(newVal, old) {
        console.log("RECORD CHANGED!", newVal, old);
    }

});

})();

</script>

</dom-module>